import{r as n,j as t,e as R,A as b,m as g,_}from"./index-DbjegASZ.js";import{P as A,C as v}from"./Page-BKdIhRqp.js";function M(){const c=n.useRef(null),a=n.useRef(null),[d,j]=n.useState(!1),[l,w]=n.useState([]),[N,p]=n.useState(!0),u=n.useMemo(()=>({yaw:0,pitch:2,hfov:100}),[]),[x]=n.useState(u),C="https://pannellum.org/images/alma.jpg";n.useEffect(()=>{let e=!1;async function s(){if(!c.current)return;p(!0);try{await _(()=>import("./pannellum-BrFVQaDy.js"),[])}catch{}const r=window.pannellum;if(!r||e)return;const i=r.viewer(c.current,{type:"equirectangular",panorama:C,autoLoad:!0,yaw:x.yaw,pitch:x.pitch,hfov:x.hfov,showZoomCtrl:!0,keyboardZoom:!0,compass:!0,mouseZoom:!0});a.current=i,setTimeout(()=>{e||p(!1)},600)}return s(),()=>{e=!0;const r=a.current;if(r)try{r!=null&&r.removeHotSpot&&l.forEach(i=>{var m;return(m=r.removeHotSpot)==null?void 0:m.call(r,i.id)})}catch{}}},[c]);function f(){const e=a.current;e&&(e.setYaw(u.yaw),e.setPitch(u.pitch),e.setHfov(u.hfov))}function k(e){var y;if(!d)return;const s=a.current;if(!s)return;const r=(y=s.mouseEventToCoords)==null?void 0:y.call(s,e.nativeEvent);if(!r)return;const[i,m]=r,h=window.prompt("Ajouter un commentaire pour ce point:");if(h&&h.trim()){const o={id:`hs-${Date.now()}`,yaw:m,pitch:i,text:h.trim(),ts:new Date().toISOString()};w(S=>[...S,o]);try{s.addHotSpot({id:o.id,pitch:o.pitch,yaw:o.yaw,type:"info",text:o.text})}catch{}}}return t.jsx(A,{children:t.jsxs("div",{className:"container-page space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-xl font-semibold",children:"Visite Virtuelle 360°"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:`px-3 py-2 border rounded ${d?"bg-blue-50 border-blue-300 text-blue-700":""}`,onClick:()=>j(e=>!e),children:d?"Mode ajout: actif":"Mode ajout de marqueur"}),t.jsx("button",{className:"px-3 py-2 bg-primary text-white rounded",onClick:f,children:"Réinitialiser la vue"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-4 items-start",children:[t.jsx(v,{children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{ref:c,className:"w-full h-[70vh] md:h-[80vh] min-h-[360px] rounded-lg overflow-hidden border shadow-card",onClick:k}),N&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/60 backdrop-blur-sm",children:t.jsx(R,{label:"Chargement de la scène…"})}),t.jsx(b,{children:d&&t.jsx(g.div,{initial:{opacity:0,y:-6},animate:{opacity:1,y:0},exit:{opacity:0,y:-6},transition:{duration:.2},className:"absolute top-3 left-3 bg-white/90 backdrop-blur px-3 py-2 rounded border text-sm text-gray-700",children:"Cliquez dans la scène pour déposer un marqueur"})}),t.jsxs("div",{className:"absolute bottom-3 left-3 flex items-center gap-2 bg-white/90 backdrop-blur rounded border p-2",children:[t.jsx("button",{className:"px-2 py-1 text-sm border rounded hover:bg-gray-50",onClick:()=>{var r,i;const e=a.current;if(!e)return;const s=Math.min(120,(((r=e.getHfov)==null?void 0:r.call(e))??100)+10);(i=e.setHfov)==null||i.call(e,s)},children:"-"}),t.jsx("button",{className:"px-2 py-1 text-sm border rounded hover:bg-gray-50",onClick:()=>{var r,i;const e=a.current;if(!e)return;const s=Math.max(40,(((r=e.getHfov)==null?void 0:r.call(e))??100)-10);(i=e.setHfov)==null||i.call(e,s)},children:"+"}),t.jsx("button",{className:"px-2 py-1 text-sm border rounded hover:bg-gray-50",onClick:f,children:"Réinitialiser"})]})]})}),t.jsx(v,{title:`Annotations (${l.length})`,children:t.jsxs("div",{className:"space-y-3 max-h-[70vh] md:max-h-[80vh] overflow-y-auto",children:[t.jsx(b,{initial:!1,children:l.map(e=>t.jsxs(g.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},transition:{duration:.15},className:"border rounded p-3 text-sm",children:[t.jsx("div",{className:"font-medium mb-1",children:e.text}),t.jsxs("div",{className:"text-xs text-gray-600",children:["Yaw: ",e.yaw.toFixed(1)," · Pitch: ",e.pitch.toFixed(1)]}),t.jsx("div",{className:"text-xs text-gray-600",children:new Date(e.ts).toLocaleString("fr-FR")})]},e.id))}),l.length===0&&t.jsx("div",{className:"text-sm text-gray-600",children:"Aucune annotation — activez le mode ajout pour créer des marqueurs."})]})})]})]})})}export{M as default};
